<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Biquad Automation example</title>
  </head>

  <body>
    <h1>Biquad Automation example</h1>

    <p>
      Here's a simple test for automating a Biquad filter.  The main intent is
      have a fast automation to demonstrate a-rate automation, if available.
      While we could add a check to see if your browser supports a-rate biquads,
      we haven't done it.  It's not hard, but just needs some work.
    </p>

    <p>
      This is based on the example from <a
      href="https://github.com/WebAudio/web-audio-api/issues/509#issuecomment-94731355">WebAudio
      issue #509</a>.  We have a 440-Hz sine-wave oscillator connected to a
      bandpass filter.  The center frequency of the filter is 264 Hz.  The
      center frequency of the filter is driven by another sine-wave oscillator
      with a frequency of 103 Hz with an amplitude of 148.  This causes the
      center frequency of the bandpass filter to oscillate between 116 Hz to 412
      Hz.
    </p>
    <p>
      If only k-rate automation is supported, the output should be a little bit
      buzzy. With a-rate automation, the sound should be smooth.
    </p>

    <button type="Test" onclick="doTest()">Press to start and stop the test</button>
    <script>
      var context = new AudioContext();
      var src;
      var osc;
      var filt = context.createBiquadFilter();
      var gain = context.createGain();
      var play = true;

      function doTest() {
        if (play)
          startTest();
        else
          stopTest();
      }

      function startTest() {
        play = false;
        // Create the audio source oscillator
        src = context.createOscillator();
        src.frequency.value = 440;

        // Creating the oscillator that modulates the filter center frequency.
        osc = context.createOscillator();

        osc.frequency.value = 103;

        // Set up the filter.
        filt.type = "bandpass";
        filt.frequency.value = 264;;

        // Gain applied to the modulating oscillator.  This causes the
        // oscillator to go from -148 to 148.  This gets summed with the filter
        // frequency value of 264 to produce a center frequency that varies from
        // 116 Hz to 412 Hz.
        gain.gain.value = 148;
        osc.connect(gain);
        gain.connect(filt.frequency);

        // Connect the source and filter together.
        src.connect(filt);
        filt.connect(context.destination);

        // Go!
        src.start();
        osc.start();
      }

      function stopTest() {
        play = true;
        // Stop!
        src.stop();
        osc.stop();
      }

    </script>
    <hr>
    <address><a href="mailto:rtoy@google.com">Raymond Toy</a></address>
<!-- Created: Tue Dec 15 21:57:34 PST 2015 -->
<!-- hhmts start -->
Last modified: Tue Dec 15 22:41:41 PST 2015
<!-- hhmts end -->
  </body>
</html>
